var homeUrl="http://www.einthusan.com/",languages,cookieValidDuration=60*60*24*30*12,backgroundPage=null;setTimeout(render,50);window.onclose=function(){alert("window closed")};function render(){if(chrome.extension.getBackgroundPage().isDataReady){var a=document.getElementById("progressIndicatorDiv");a.style.display="none";backgroundPage=chrome.extension.getBackgroundPage();languages=backgroundPage.languages;displayLanguageButtons(languages);getMoviesForLanguage(languages[0])}else{a=document.getElementById("progressIndicatorDiv");a.style.display="block";setTimeout(render,200)}}function getMovieTitles(a){var b=a.innerText;getMoviesForLanguage(b)}function getMoviesForLanguage(b){document.getElementById(b.toLowerCase()+"Button").setAttribute("class","btn btn-success");for(i=0;i<languages.length;i++){var d=document.getElementById(languages[i].toLowerCase()+"Button");if(languages[i]==b){d.setAttribute("class","btn btn-success")}else{d.setAttribute("class","btn")}}var a=languages.indexOf(b),c=backgroundPage.fetchedTitles[a];displayMovieTitles(c);setCookie(b.toLowerCase(),c);if(backgroundPage.newMoviesCnt[a]>0){sendMessage(backgroundPage.RESET_NEW_FLAGS,b)}}function displayMovieTitles(l){var j=document.getElementById("movieTitles"),f=document.createElement("tbody"),b,e,k,c,a,d,m,h,g;j.innerHTML="";for(i=0;i<l.length;i++){b=l[i].movieTitle;e=l[i].movieCover;k=document.createElement("tr");if(l[i].isNew){k.setAttribute("class","warning")}c=document.createElement("td");a=document.createElement("td");d=document.createElement("td");m=document.createElement("img");m.setAttribute("src",homeUrl+e);m.setAttribute("style","height:56px");m.setAttribute("class","img-rounded");d.appendChild(m);a.innerText=i+1+".";h=document.createElement("div");h.innerHTML=b;c.appendChild(h);k.appendChild(d);k.appendChild(c);k.style.cursor="pointer";g=getClickHandler(homeUrl+l[i].watchURL);k.addEventListener("click",g);f.appendChild(k)}j.appendChild(f)}function getClickHandler(a){return function(){chrome.tabs.create({url:a},function(){})}}function displayLanguageButtons(e){var a=document.getElementById("languageButtons"),d,c,f,h,g,b;if(e.length>0&&a){d=document.createElement("tr");for(i=0;i<e.length;i++){c=document.createElement("button");c.setAttribute("class","btn");c.setAttribute("id",e[i].toLowerCase()+"Button");c.innerHTML=e[i];f=e[i];c.addEventListener("click",function(){getMovieTitles(this)});h=document.createElement("td");h.setAttribute("style","border-top:none;");g=document.createElement("div");g.setAttribute("style","position:relative;");g.appendChild(c);if(backgroundPage.newMoviesCnt[i]>0){b=document.createElement("span");b.setAttribute("class","badge badge-warning");b.setAttribute("style","position:absolute; right:-8px;top:-8px;");b.innerText=backgroundPage.newMoviesCnt[i];g.appendChild(b)}h.appendChild(g);d.appendChild(h)}a.appendChild(d)}}function setCookie(b,c){var a=new Object();a.url=homeUrl;a.name=b.toLowerCase()+"Movies";a.value=buildCookieString(c);a.expirationDate=(new Date().getTime()/1000)+cookieValidDuration;chrome.cookies.remove({url:homeUrl,name:a.name});chrome.cookies.set(a)}function buildCookieString(a){var b="";for(i=0;i<a.length;i++){b=b.concat(a[i].movieTitle);if(i<a.length-1){b=b.concat("--")}}return b}function sendMessage(a,b){var c=new Object();c.messageType=a;if(a==backgroundPage.RESET_NEW_FLAGS){c.language=b}chrome.extension.sendRequest(c,function(d){if(d.messageType==backgroundPage.FLAGS_RESET){updateButtonBadge(b)}})}function updateButtonBadge(b){var a=document.getElementById(b.toLowerCase()+"Button");a.parentNode.removeChild(a.parentNode.lastChild)};